{% extends "nav.html" %}

<!doctype html>
<html>
    <head>
        {% block head %}
        <meta charset="utf-8">
        <meta name=author content="Sandra Xu">  
        <title>Home â€¢ Feed</title>
        <link rel="stylesheet" type="text/css"
              href="{{url_for('static', filename='home.css')}}">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bricklayer/0.4.2/bricklayer.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/bricklayer/0.4.2/bricklayer.min.js"></script>
        <link rel="stylesheet" 
              href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://kit.fontawesome.com/cc5f13310d.js" crossorigin="anonymous"></script>
        {% endblock %}
    </head>

    <body>

        {% block options %}
            {% if options is sameas true %}
            <div id="options">
                <span>
                    <!-- <form id="sort-by-form" method=GET action="/home/"> -->
                        <label>Sort by</label>
                        <select name="sort-by" id="sort-by">
                            <option value="recent">Most Recent</option>
                            <option value="rating">Rating</option>
                            <option value="price">Price</option>
                        </select>
                    <!-- </form> -->
                </span>
                <span>
                    <form id="tag-form">
                        <label>Category</label>
                        <select name="tag" id="tag" onchange="this.form.submit()">
                            <option selected disabled>Choose</option>
                            {% for tag in tags %}
                            <option>{{tag['ttype']}}</option>
                            {% endfor %}
                        </select>
                    </form>
                </span>
                <!-- <span id="filter-tag"></span> -->
            </div>
            {% endif %}
        {% endblock %}
        
        <!-- WHY are flashes showing up before options -->
        {% block flash %}
            {{super()}}
        {%endblock %}

        {% block content %}
        <!--  BOOTSTRAP CARD -->

            <!-- <div id="posts" class="masonry card-columns">
            {% for post in posts %}
            <a href="{{url_for('post', pid=post.pid)}}" class = "custom-card"> 
                <div class="item card">
                 rd-image-top img-fluid post-image"> -->
                    <!-- <img class="card-image-top img-fluid rounded-top post-image" 
                        src="{{url_for('static',filename=post['imgPath'])}}">
                 
                    <div class="card-body">
                        <h5 class="card-title">{{post['pname']}}</h5>
                        <p class="card-text rating" data-rating="{{post['rating']}}"></p>
                        <p class="card-text">{{post['review'] | truncate(150)}}</p>
                    </div>
                </div>
            </a>

            {% endfor %}
            </div>  -->

            <!-- MASONRY -->
            <div id="masonry" class="grid">
                
                {% for post in posts %}
                <div class="grid-item">
                    <a href="{{url_for('post', pid=post.pid)}}" class = "custom-card"> 
                        <div class="item card">
                            <!-- image -->

                            <!-- <div class="card-image-top img-fluid post-image"> -->
                            <img class="card-image-top img-fluid rounded-top post-image" 
                                src="{{url_for('static',filename=post['imgPath'])}}">
                            <!-- </div> -->
                        
                            <div class="card-body">
                                <h5 class="card-title">{{post['pname']}}</h5>
                                <!-- rating -->
                                <p class="card-text rating" data-rating="{{post['rating']}}"></p>
                                <p class="card-text">{{post['review'] | truncate(150)}}</p>
                            </div>
                        </div>
                    </a>
                </div>

            {% endfor %}
            </div>


            <div id="users" class="masonry card-columns">
            {% for user in users %}
            <a href="{{url_for('profile', username=user.username)}}" class = "custom-card"> 
                <div class="item card">
                 {# ... 
                    <!-- <img src="{{post['imgPath']}}"> -->
                    <!-- <img class="card-image-top img-fluid" src="{{url_for('static',filename=post['imgPath'])}}">
                     -->#}
                    <div class="card-body">
                        <h5 class="card-title">{{user['username']}}</h5>
                        {#
                        <!-- rating -->
                        <!-- <p class="card-text rating" data-rating="{{post['rating']}}"></p>
                        <p class="card-text">{{post['review'] | truncate(150)}}</p> -->#}
                    </div>
                </div>
                </a>
                {% endfor %}
          
            </div>

        {% endblock %}

        {% block scripts %}
           {{super()}}
            <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
            <script src="{{url_for('static',filename='home.js')}}"></script>
            <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.js"></script>
            <script>
                // external js: masonry.pkgd.js
                window.addEventListener('load', function () {
                  console.log("It's loaded!");
                    colWidth = ($("#masonry").innerWidth() - 10*(parseFloat($(".grid-item").css("margin").slice(0,-2))))/5.0;
                    // console.log(colWidth);
                    // console.log($("#masonry").innerWidth());
                    // console.log(parseFloat($(".grid-item").css("margin").slice(0,-2)));

                    // need to set the height of each grid item
                    $(".grid-item").each(function() {
                        // this.height(this.find(".custom-card").height());
                        // console.log(this);
                        // console.log("here");
                        $(this).height($(this).find(".custom-card")+50);
                        $(this).width(colWidth);
                    
                    });

                    // for 5 columns, make dynamic later
                    

                    $('.grid').masonry({
                        itemSelector: '.grid-item',
                        columnWidth: '.grid-item',
                        horizontalOrder: true
                    });
                })
              

            </script>
        {% endblock %}   
    
</body>
</html>


